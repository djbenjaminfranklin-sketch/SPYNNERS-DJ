{"dependencies":[{"name":"../utils/sharedInstance","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":60,"index":60}}],"key":"fZWaVZXRV+td3A9HZ0+ZfG+s/ro=","exportNames":["*"],"imports":1}},{"name":"../utils/common","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":61},"end":{"line":2,"column":47,"index":108}}],"key":"KsodrK4j9cfxMx/6SogWBqcOsfM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"USER_HEARTBEAT_EVENT_NAME\",{enumerable:!0,get:function(){return s}}),Object.defineProperty(e,\"ANALYTICS_CONFIG_ENABLE_URL_PARAM_KEY\",{enumerable:!0,get:function(){return o}}),Object.defineProperty(e,\"ANALYTICS_SESSION_ID_LOCAL_STORAGE_KEY\",{enumerable:!0,get:function(){return c}}),Object.defineProperty(e,\"createAnalyticsModule\",{enumerable:!0,get:function(){return f}}),e.getAnalyticsConfigFromUrlParams=y,e.getAnalyticsSessionId=b;var t=r(d[0]),n=r(d[1]);const s=\"__user_heartbeat_event__\",o=\"analytics-enable\",c=\"base44_analytics_session_id\",u={enabled:!1,maxQueueSize:1e3,throttleTime:1e3,batchSize:30,heartBeatInterval:6e4},l=(0,t.getSharedInstance)(\"analytics\",()=>({requestsQueue:[],isProcessing:!1,isHeartBeatProcessing:!1,sessionContext:null,config:{...u,...y()}})),f=({axiosClient:t,serverUrl:n,appId:s,userAuthModule:o})=>{var c;const{maxQueueSize:u,throttleTime:f,batchSize:h}=l.config;if(!(null===(c=l.config)||void 0===c?void 0:c.enabled))return{track:()=>{},cleanup:()=>{}};let y;const b=`${n}/api/apps/${s}/analytics/track/batch`,P=async n=>{await t.request({method:\"POST\",url:`/apps/${s}/analytics/track/batch`,data:{events:n}})},S=t=>{try{const n=JSON.stringify({events:t}),s=new Blob([n],{type:\"application/json\"});return\"undefined\"==typeof navigator||n.length>6e4||!navigator.sendBeacon(b,s)}catch(t){return!1}},A=async(t,n={})=>{if(0===t.length)return;const s=await v(o),c=t.map((u=s,t=>({event_name:t.eventName,properties:t.properties,timestamp:t.timestamp,page_url:t.pageUrl,...u})));var u;try{n.isBeacon&&S(c)||await P(c)}catch(t){}},I=()=>{_(A,{throttleTime:f,batchSize:h})},B=t=>{if(l.requestsQueue.length>=u)return;const n={timestamp:(new Date).toISOString(),pageUrl:null};l.requestsQueue.push({...t,...n}),I()};return I(),y=p(B),{track:B,cleanup:()=>{l.isProcessing=!1,null==y||y()}}};async function _(t,n){if(l.isProcessing)return;l.isProcessing=!0;const{throttleTime:s=1e3,batchSize:o=30}=null!=n?n:{};for(;l.isProcessing&&l.requestsQueue.length>0;){const n=l.requestsQueue.splice(0,o);n.length&&await t(n),await new Promise(t=>setTimeout(t,s))}l.isProcessing=!1}function p(t){var n;if(l.isHeartBeatProcessing||(null!==(n=l.config.heartBeatInterval)&&void 0!==n?n:0)<10)return()=>{};l.isHeartBeatProcessing=!0;const o=setInterval(()=>{t({eventName:s})},l.config.heartBeatInterval);return()=>{clearInterval(o),l.isHeartBeatProcessing=!1}}let h=null;async function v(t){if(!l.sessionContext){if(!h){const n=b();h=t.me().then(t=>({user_id:t.id,session_id:n})).catch(()=>({user_id:null,session_id:n}))}l.sessionContext=await h}return l.sessionContext}function y(){}function b(){return(0,n.generateUuid)()}});","lineCount":1,"map":[[1,90,3,0,"Object"],[1,97,3,0,"defineProperty"],[1,112,3,0,"e"],[1,114,3,0],[1,143,3,0,"enumerable"],[1,155,3,0],[1,157,3,0,"get"],[1,161,3,0],[1,179,3,0,"USER_HEARTBEAT_EVENT_NAME"],[1,180,3,0],[1,184,4,0,"Object"],[1,191,4,0,"defineProperty"],[1,206,4,0,"e"],[1,208,4,0],[1,249,4,0,"enumerable"],[1,261,4,0],[1,263,4,0,"get"],[1,267,4,0],[1,285,4,0,"ANALYTICS_CONFIG_ENABLE_URL_PARAM_KEY"],[1,286,4,0],[1,290,5,0,"Object"],[1,297,5,0,"defineProperty"],[1,312,5,0,"e"],[1,314,5,0],[1,356,5,0,"enumerable"],[1,368,5,0],[1,370,5,0,"get"],[1,374,5,0],[1,392,5,0,"ANALYTICS_SESSION_ID_LOCAL_STORAGE_KEY"],[1,393,5,0],[1,397,29,0,"Object"],[1,404,29,0,"defineProperty"],[1,419,29,0,"e"],[1,421,29,0],[1,446,29,0,"enumerable"],[1,458,29,0],[1,460,29,0,"get"],[1,464,29,0],[1,482,29,0,"createAnalyticsModule"],[1,483,29,0],[1,487,204,0,"e"],[1,489,204,0,"getAnalyticsConfigFromUrlParams"],[1,523,221,0,"e"],[1,525,221,0,"getAnalyticsSessionId"],[1,549,1,0],[1,553,1,0,"_utilsSharedInstance"],[1,555,1,0,"r"],[1,557,1,0,"d"],[1,559,1,0],[1,563,2,0,"_utilsCommon"],[1,565,2,0,"r"],[1,567,2,0,"d"],[1,569,2,0],[1,573,3,7],[1,579,3,13,"USER_HEARTBEAT_EVENT_NAME"],[1,581,3,41],[1,608,4,13,"ANALYTICS_CONFIG_ENABLE_URL_PARAM_KEY"],[1,610,4,53],[1,629,5,13,"ANALYTICS_SESSION_ID_LOCAL_STORAGE_KEY"],[1,631,5,54],[1,661,6,6,"defaultConfiguration"],[1,663,6,29],[1,664,8,4,"enabled"],[1,673,8,13],[1,675,9,4,"maxQueueSize"],[1,688,9,18],[1,692,10,4,"throttleTime"],[1,705,10,18],[1,709,11,4,"batchSize"],[1,719,11,15],[1,722,12,4,"heartBeatInterval"],[1,740,12,21],[1,745,19,6,"analyticsSharedState"],[1,748,19,29],[1,750,19,29,"getSharedInstance"],[1,752,19,46,"getSharedInstance"],[1,771,17,36],[1,783,19,76],[1,789,20,4,"requestsQueue"],[1,803,20,19],[1,806,21,4,"isProcessing"],[1,820,21,18],[1,822,22,4,"isHeartBeatProcessing"],[1,845,22,27],[1,847,23,4,"sessionContext"],[1,862,23,20],[1,867,24,4,"config"],[1,874,24,12],[1,878,25,11,"defaultConfiguration"],[1,883,26,11,"getAnalyticsConfigFromUrlParams"],[1,891,29,13,"createAnalyticsModule"],[1,893,29,37,"createAnalyticsModule"],[1,895,29,40,"axiosClient"],[1,909,29,53,"serverUrl"],[1,921,29,64,"appId"],[1,929,29,71,"userAuthModule"],[1,950,30,4],[1,954,30,8,"_a"],[1,956,32,4],[1,962,32,10,"maxQueueSize"],[1,975,32,12,"maxQueueSize"],[1,977,32,24,"throttleTime"],[1,990,32,26,"throttleTime"],[1,992,32,38,"batchSize"],[1,1002,32,40,"batchSize"],[1,1005,32,54,"analyticsSharedState"],[1,1007,32,75,"config"],[1,1014,33,4],[1,1019,33,49],[1,1027,33,11,"_a"],[1,1029,33,16,"analyticsSharedState"],[1,1031,33,37,"config"],[1,1045,33,59,"undefined"],[1,1049,33,57,"_a"],[1,1056,33,70,"undefined"],[1,1058,33,82,"_a"],[1,1060,33,85,"enabled"],[1,1069,34,8],[1,1075,34,15],[1,1076,35,12,"track"],[1,1082,35,19,"track"],[1,1089,36,12,"cleanup"],[1,1097,36,21,"cleanup"],[1,1105,39,4],[1,1109,39,8,"clearHeartBeatProcessor"],[1,1111,40,4],[1,1117,40,10,"trackBatchUrl"],[1,1119,40,26],[1,1122,40,29,"serverUrl"],[1,1136,40,51,"appId"],[1,1162,41,10,"batchRequestFallback"],[1,1164,41,33,"async"],[1,1180,42,14,"axiosClient"],[1,1182,42,26,"request"],[1,1190,42,34],[1,1191,43,12,"method"],[1,1198,43,20],[1,1205,44,12,"url"],[1,1209,44,17],[1,1218,44,26,"appId"],[1,1244,45,12,"data"],[1,1249,45,18],[1,1250,45,20,"events"],[1,1263,49,10,"beaconRequest"],[1,1265,49,27,"events"],[1,1269,50,8],[1,1273,51,12],[1,1279,51,18,"beaconPayload"],[1,1281,51,34,"JSON"],[1,1286,51,39,"stringify"],[1,1296,51,49],[1,1297,51,51,"events"],[1,1308,52,18,"blob"],[1,1310,52,25],[1,1314,52,29,"Blob"],[1,1319,52,34],[1,1320,52,35,"beaconPayload"],[1,1323,52,51],[1,1324,52,53,"type"],[1,1329,52,59],[1,1350,53,12],[1,1356,53,41],[1,1376,53,27,"navigator"],[1,1387,54,16,"beaconPayload"],[1,1389,54,30,"length"],[1,1396,54,39],[1,1402,55,17,"navigator"],[1,1412,55,27,"sendBeacon"],[1,1423,55,38,"trackBatchUrl"],[1,1425,55,53,"blob"],[1,1427,56,8],[1,1428,57,8],[1,1434,57,15,"_a"],[1,1437,58,12],[1,1444,58,19],[1,1445,59,8],[1,1448,61,10,"flush"],[1,1450,61,18,"async"],[1,1456,61,25,"eventsData"],[1,1458,61,37,"options"],[1,1460,61,47],[1,1461,61,48],[1,1466,62,8],[1,1469,62,34],[1,1473,62,12,"eventsData"],[1,1475,62,23,"length"],[1,1482,63,12],[1,1489,64,8],[1,1495,64,14,"sessionContext_"],[1,1503,64,38,"getSessionContext"],[1,1505,64,56,"userAuthModule"],[1,1508,65,14,"events"],[1,1510,65,23,"eventsData"],[1,1512,65,34,"map"],[1,1517,175,44,"sessionContext"],[1,1519,65,73,"sessionContext_"],[1,1521,176,12,"eventData"],[1,1525,176,21],[1,1526,177,8,"event_name"],[1,1537,177,20,"eventData"],[1,1539,177,30,"eventName"],[1,1549,178,8,"properties"],[1,1560,178,20,"eventData"],[1,1562,178,30,"properties"],[1,1573,179,8,"timestamp"],[1,1583,179,19,"eventData"],[1,1585,179,29,"timestamp"],[1,1595,180,8,"page_url"],[1,1604,180,18,"eventData"],[1,1606,180,28,"pageUrl"],[1,1617,181,11,"sessionContext"],[1,1623,175,0],[1,1627,175,44,"sessionContext"],[1,1629,66,8],[1,1633,67,17,"options"],[1,1635,67,25,"isBeacon"],[1,1645,67,38,"beaconRequest"],[1,1647,67,52,"events"],[1,1657,68,22,"batchRequestFallback"],[1,1659,68,43,"events"],[1,1661,70,8],[1,1662,71,8],[1,1668,71,15,"_a"],[1,1671,72,12],[1,1674,75,10,"startProcessing"],[1,1676,75,28,"startProcessing"],[1,1681,76,8,"startAnalyticsProcessor"],[1,1683,76,32,"flush"],[1,1685,76,39],[1,1686,77,12,"throttleTime"],[1,1701,78,12,"batchSize"],[1,1716,81,10,"track"],[1,1718,81,19,"params"],[1,1722,82,8],[1,1725,82,12,"analyticsSharedState"],[1,1727,82,33,"requestsQueue"],[1,1741,82,47,"length"],[1,1749,82,57,"maxQueueSize"],[1,1751,83,12],[1,1758,85,8],[1,1764,85,14,"intrinsicData"],[1,1766,170,11],[1,1767,171,8,"timestamp"],[1,1778,171,19],[1,1782,171,23,"Date"],[1,1788,171,30,"toISOString"],[1,1802,172,8,"pageUrl"],[1,1810,172,76],[1,1816,86,8,"analyticsSharedState"],[1,1818,86,29,"requestsQueue"],[1,1832,86,43,"push"],[1,1837,86,48],[1,1841,87,15,"params"],[1,1846,88,15,"intrinsicData"],[1,1850,90,8,"startProcessing"],[1,1855,131,4],[1,1862,124,4,"startProcessing"],[1,1866,126,4,"clearHeartBeatProcessor"],[1,1868,126,30,"startHeartBeatProcessor"],[1,1870,126,54,"track"],[1,1873,131,11],[1,1874,132,8,"track"],[1,1882,133,8,"cleanup"],[1,1890,116,20,"cleanup"],[1,1895,137,4,"analyticsSharedState"],[1,1897,137,25,"isProcessing"],[1,1911,137,40],[1,1913,118,8,"clearHeartBeatProcessor"],[1,1922,118,90,"clearHeartBeatProcessor"],[1,1929,139,0,"async"],[1,1944,139,15,"startAnalyticsProcessor"],[1,1946,139,39,"handleTrack"],[1,1948,139,52,"options"],[1,1951,140,4],[1,1954,140,8,"analyticsSharedState"],[1,1956,140,29,"isProcessing"],[1,1969,142,8],[1,1976,144,4,"analyticsSharedState"],[1,1978,144,25,"isProcessing"],[1,1992,144,40],[1,1994,145,4],[1,2000,145,10,"throttleTime"],[1,2013,145,12,"throttleTime"],[1,2015,145,27],[1,2019,145,31,"batchSize"],[1,2029,145,33,"batchSize"],[1,2031,145,45],[1,2035,145,52,"options"],[1,2043,145,93,"options"],[1,2045,145,103],[1,2046,145,104],[1,2048,146,4],[1,2053,146,11,"analyticsSharedState"],[1,2055,146,32,"isProcessing"],[1,2069,147,8,"analyticsSharedState"],[1,2071,147,29,"requestsQueue"],[1,2085,147,43,"length"],[1,2092,147,52],[1,2095,147,55],[1,2096,148,8],[1,2102,148,14,"requests"],[1,2104,148,25,"analyticsSharedState"],[1,2106,148,46,"requestsQueue"],[1,2120,148,60,"splice"],[1,2127,148,67],[1,2129,148,70,"batchSize"],[1,2132,149,8,"requests"],[1,2134,149,17,"length"],[1,2148,149,34,"handleTrack"],[1,2150,149,46,"requests"],[1,2159,150,14],[1,2163,150,18,"Promise"],[1,2171,150,27,"resolve"],[1,2174,150,39,"setTimeout"],[1,2185,150,50,"resolve"],[1,2187,150,59,"throttleTime"],[1,2190,151,4],[1,2191,152,4,"analyticsSharedState"],[1,2193,152,25,"isProcessing"],[1,2207,152,40],[1,2208,153,0],[1,2209,154,0],[1,2218,154,9,"startHeartBeatProcessor"],[1,2220,154,33,"track"],[1,2223,155,4],[1,2227,155,8,"_a"],[1,2229,156,4],[1,2232,156,8,"analyticsSharedState"],[1,2234,156,29,"isHeartBeatProcessing"],[1,2258,157,66],[1,2266,157,10,"_a"],[1,2268,157,15,"analyticsSharedState"],[1,2270,157,36,"config"],[1,2277,157,43,"heartBeatInterval"],[1,2302,157,76,"undefined"],[1,2306,157,74,"_a"],[1,2308,157,90,"_a"],[1,2310,157,95],[1,2313,157,100],[1,2316,158,8],[1,2322,158,15],[1,2329,160,4,"analyticsSharedState"],[1,2331,160,25,"isHeartBeatProcessing"],[1,2354,160,49],[1,2356,161,4],[1,2362,161,10,"interval"],[1,2364,161,21,"setInterval"],[1,2376,161,33],[1,2381,162,8,"track"],[1,2383,162,14],[1,2384,162,16,"eventName"],[1,2394,162,27,"USER_HEARTBEAT_EVENT_NAME"],[1,2399,163,7,"analyticsSharedState"],[1,2401,163,28,"config"],[1,2408,163,35,"heartBeatInterval"],[1,2427,164,4],[1,2433,164,11],[1,2438,165,8,"clearInterval"],[1,2452,165,22,"interval"],[1,2455,166,8,"analyticsSharedState"],[1,2457,166,29,"isHeartBeatProcessing"],[1,2480,166,53],[1,2482,168,0],[1,2483,184,0],[1,2487,184,4,"sessionContextPromise"],[1,2489,184,28],[1,2494,185,0,"async"],[1,2509,185,15,"getSessionContext"],[1,2511,185,33,"userAuthModule"],[1,2514,186,4],[1,2518,186,9,"analyticsSharedState"],[1,2520,186,30,"sessionContext"],[1,2535,186,46],[1,2536,187,8],[1,2540,187,13,"sessionContextPromise"],[1,2542,187,36],[1,2543,188,12],[1,2549,188,18,"sessionId"],[1,2551,188,30,"getAnalyticsSessionId"],[1,2555,189,12,"sessionContextPromise"],[1,2557,189,36,"userAuthModule"],[1,2559,190,17,"me"],[1,2564,191,17,"then"],[1,2569,191,23,"user"],[1,2573,191,27],[1,2574,192,16,"user_id"],[1,2582,192,25,"user"],[1,2584,192,30,"id"],[1,2587,193,16,"session_id"],[1,2598,193,28,"sessionId"],[1,2603,195,17,"catch"],[1,2609,195,23],[1,2615,196,16,"user_id"],[1,2623,196,25],[1,2628,197,16,"session_id"],[1,2639,197,28,"sessionId"],[1,2643,199,8],[1,2644,200,8,"analyticsSharedState"],[1,2646,200,29,"sessionContext"],[1,2667,200,52,"sessionContextPromise"],[1,2668,201,4],[1,2669,202,4],[1,2676,202,11,"analyticsSharedState"],[1,2678,202,32,"sessionContext"],[1,2692,203,0],[1,2693,204,7],[1,2702,204,16,"getAnalyticsConfigFromUrlParams"],[1,2706,220,0],[1,2707,221,7],[1,2716,221,16,"getAnalyticsSessionId"],[1,2720,223,8],[1,2727,223,15],[1,2729,223,15,"generateUuid"],[1,2731,223,27,"generateUuid"],[1,2746,237,0],[1,2747,237,1],[1,2750]],"functionMap":{"names":["<global>","getSharedInstance$argument_1","createAnalyticsModule","track","cleanup","batchRequestFallback","beaconRequest","flush","startProcessing","onDocVisible","onDocHidden","onVisibilityChange","stopAnalyticsProcessor","startAnalyticsProcessor","Promise$argument_0","startHeartBeatProcessor","<anonymous>","setInterval$argument_0","getEventIntrinsicData","transformEventDataToApiRequestData","getSessionContext","userAuthModule.me.then$argument_0","userAuthModule.me.then._catch$argument_0","getAnalyticsConfigFromUrlParams","getAnalyticsSessionId"],"mappings":"AAA;4ECkB;EDS;qCEC;mBCM,SD;qBEC,SF;iCGK;KHM;0BIE;KJW;kBKC;KLa;4BMC;KNK;kBCC;KDU;yBOC;KPM;wBQC;KRM;+BSC;KTS;oBEC;KFM;CFa;AYC;CZE;AaC;0BCW,8CD;CbG;AeC;eCI,SD;iCEG;KFE;WCC;KDG;CfC;AkBC;ClBK;AmBC;WHC;MGM;CnBC;AoBE;sBCM;cDG;uBEC;cFG;CpBK;OuBC;CvBgB;OwBC;CxBgB"},"hasCjsExports":false},"type":"js/module"}]}