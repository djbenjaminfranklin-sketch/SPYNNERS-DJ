{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../utils/auth-utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":56,"index":56}}],"key":"ZBmctxxjxi3m55Nlej4mfi6fkFI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.createAgentsModule = createAgentsModule;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _utilsAuthUtilsJs = require(_dependencyMap[1], \"../utils/auth-utils.js\");\n  function createAgentsModule(_ref) {\n    var axios = _ref.axios,\n      getSocket = _ref.getSocket,\n      appId = _ref.appId,\n      serverUrl = _ref.serverUrl,\n      token = _ref.token;\n    var baseURL = `/apps/${appId}/agents`;\n    var getConversations = () => {\n      return axios.get(`${baseURL}/conversations`);\n    };\n    var getConversation = conversationId => {\n      return axios.get(`${baseURL}/conversations/${conversationId}`);\n    };\n    var listConversations = filterParams => {\n      return axios.get(`${baseURL}/conversations`, {\n        params: filterParams\n      });\n    };\n    var createConversation = conversation => {\n      return axios.post(`${baseURL}/conversations`, conversation);\n    };\n    var addMessage = /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (conversation, message) {\n        var room = `/agent-conversations/${conversation.id}`;\n        var socket = getSocket();\n        yield socket.updateModel(room, {\n          ...conversation,\n          messages: [...(conversation.messages || []), message]\n        });\n        return axios.post(`${baseURL}/conversations/${conversation.id}/messages`, message);\n      });\n      return function addMessage(_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var subscribeToConversation = (conversationId, onUpdate) => {\n      var room = `/agent-conversations/${conversationId}`;\n      var socket = getSocket();\n      return socket.subscribeToRoom(room, {\n        connect: () => {},\n        update_model: _ref3 => {\n          var jsonStr = _ref3.data;\n          var conv = JSON.parse(jsonStr);\n          onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(conv);\n        }\n      });\n    };\n    var getWhatsAppConnectURL = agentName => {\n      var baseUrl = `${serverUrl}/api/apps/${appId}/agents/${encodeURIComponent(agentName)}/whatsapp`;\n      var accessToken = token !== null && token !== void 0 ? token : (0, _utilsAuthUtilsJs.getAccessToken)();\n      if (accessToken) {\n        return `${baseUrl}?token=${accessToken}`;\n      } else {\n        // No token - URL will redirect to login automatically\n        return baseUrl;\n      }\n    };\n    return {\n      getConversations,\n      getConversation,\n      listConversations,\n      createConversation,\n      addMessage,\n      subscribeToConversation,\n      getWhatsAppConnectURL\n    };\n  }\n});","lineCount":83,"map":[[12,2,2,0,"exports"],[12,9,2,0],[12,10,2,0,"createAgentsModule"],[12,28,2,0],[12,31,2,0,"createAgentsModule"],[12,49,2,0],[13,2,58,1],[13,6,58,1,"_babelRuntimeHelpersAsyncToGenerator"],[13,42,58,1],[13,45,58,1,"require"],[13,52,58,1],[13,53,58,1,"_dependencyMap"],[13,67,58,1],[14,2,58,1],[14,6,58,1,"_asyncToGenerator"],[14,23,58,1],[14,26,58,1,"_interopDefault"],[14,41,58,1],[14,42,58,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,78,58,1],[15,2,1,0],[15,6,1,0,"_utilsAuthUtilsJs"],[15,23,1,0],[15,26,1,0,"require"],[15,33,1,0],[15,34,1,0,"_dependencyMap"],[15,48,1,0],[16,2,2,7],[16,11,2,16,"createAgentsModule"],[16,29,2,34,"createAgentsModule"],[16,30,2,34,"_ref"],[16,34,2,34],[16,36,2,83],[17,4,2,83],[17,8,2,37,"axios"],[17,13,2,42],[17,16,2,42,"_ref"],[17,20,2,42],[17,21,2,37,"axios"],[17,26,2,42],[18,6,2,44,"getSocket"],[18,15,2,53],[18,18,2,53,"_ref"],[18,22,2,53],[18,23,2,44,"getSocket"],[18,32,2,53],[19,6,2,55,"appId"],[19,11,2,60],[19,14,2,60,"_ref"],[19,18,2,60],[19,19,2,55,"appId"],[19,24,2,60],[20,6,2,62,"serverUrl"],[20,15,2,71],[20,18,2,71,"_ref"],[20,22,2,71],[20,23,2,62,"serverUrl"],[20,32,2,71],[21,6,2,73,"token"],[21,11,2,78],[21,14,2,78,"_ref"],[21,18,2,78],[21,19,2,73,"token"],[21,24,2,78],[22,4,3,4],[22,8,3,10,"baseURL"],[22,15,3,17],[22,18,3,20],[22,27,3,29,"appId"],[22,32,3,34],[22,41,3,43],[23,4,4,4],[23,8,4,10,"getConversations"],[23,24,4,26],[23,27,4,29,"getConversations"],[23,28,4,29],[23,33,4,35],[24,6,5,8],[24,13,5,15,"axios"],[24,18,5,20],[24,19,5,21,"get"],[24,22,5,24],[24,23,5,25],[24,26,5,28,"baseURL"],[24,33,5,35],[24,49,5,51],[24,50,5,52],[25,4,6,4],[25,5,6,5],[26,4,7,4],[26,8,7,10,"getConversation"],[26,23,7,25],[26,26,7,29,"conversationId"],[26,40,7,43],[26,44,7,48],[27,6,8,8],[27,13,8,15,"axios"],[27,18,8,20],[27,19,8,21,"get"],[27,22,8,24],[27,23,8,25],[27,26,8,28,"baseURL"],[27,33,8,35],[27,51,8,53,"conversationId"],[27,65,8,67],[27,67,8,69],[27,68,8,70],[28,4,9,4],[28,5,9,5],[29,4,10,4],[29,8,10,10,"listConversations"],[29,25,10,27],[29,28,10,31,"filterParams"],[29,40,10,43],[29,44,10,48],[30,6,11,8],[30,13,11,15,"axios"],[30,18,11,20],[30,19,11,21,"get"],[30,22,11,24],[30,23,11,25],[30,26,11,28,"baseURL"],[30,33,11,35],[30,49,11,51],[30,51,11,53],[31,8,12,12,"params"],[31,14,12,18],[31,16,12,20,"filterParams"],[32,6,13,8],[32,7,13,9],[32,8,13,10],[33,4,14,4],[33,5,14,5],[34,4,15,4],[34,8,15,10,"createConversation"],[34,26,15,28],[34,29,15,32,"conversation"],[34,41,15,44],[34,45,15,49],[35,6,16,8],[35,13,16,15,"axios"],[35,18,16,20],[35,19,16,21,"post"],[35,23,16,25],[35,24,16,26],[35,27,16,29,"baseURL"],[35,34,16,36],[35,50,16,52],[35,52,16,54,"conversation"],[35,64,16,66],[35,65,16,67],[36,4,17,4],[36,5,17,5],[37,4,18,4],[37,8,18,10,"addMessage"],[37,18,18,20],[38,6,18,20],[38,10,18,20,"_ref2"],[38,15,18,20],[38,22,18,20,"_asyncToGenerator"],[38,39,18,20],[38,40,18,20,"default"],[38,47,18,20],[38,49,18,23],[38,60,18,30,"conversation"],[38,72,18,42],[38,74,18,44,"message"],[38,81,18,51],[38,83,18,56],[39,8,19,8],[39,12,19,14,"room"],[39,16,19,18],[39,19,19,21],[39,43,19,45,"conversation"],[39,55,19,57],[39,56,19,58,"id"],[39,58,19,60],[39,60,19,62],[40,8,20,8],[40,12,20,14,"socket"],[40,18,20,20],[40,21,20,23,"getSocket"],[40,30,20,32],[40,31,20,33],[40,32,20,34],[41,8,21,8],[41,14,21,14,"socket"],[41,20,21,20],[41,21,21,21,"updateModel"],[41,32,21,32],[41,33,21,33,"room"],[41,37,21,37],[41,39,21,39],[42,10,22,12],[42,13,22,15,"conversation"],[42,25,22,27],[43,10,23,12,"messages"],[43,18,23,20],[43,20,23,22],[43,21,23,23],[43,25,23,27,"conversation"],[43,37,23,39],[43,38,23,40,"messages"],[43,46,23,48],[43,50,23,52],[43,52,23,54],[43,53,23,55],[43,55,23,57,"message"],[43,62,23,64],[44,8,24,8],[44,9,24,9],[44,10,24,10],[45,8,25,8],[45,15,25,15,"axios"],[45,20,25,20],[45,21,25,21,"post"],[45,25,25,25],[45,26,25,26],[45,29,25,29,"baseURL"],[45,36,25,36],[45,54,25,54,"conversation"],[45,66,25,66],[45,67,25,67,"id"],[45,69,25,69],[45,80,25,80],[45,82,25,82,"message"],[45,89,25,89],[45,90,25,90],[46,6,26,4],[46,7,26,5],[47,6,26,5],[47,22,18,10,"addMessage"],[47,32,18,20,"addMessage"],[47,33,18,20,"_x"],[47,35,18,20],[47,37,18,20,"_x2"],[47,40,18,20],[48,8,18,20],[48,15,18,20,"_ref2"],[48,20,18,20],[48,21,18,20,"apply"],[48,26,18,20],[48,33,18,20,"arguments"],[48,42,18,20],[49,6,18,20],[50,4,18,20],[50,7,26,5],[51,4,27,4],[51,8,27,10,"subscribeToConversation"],[51,31,27,33],[51,34,27,36,"subscribeToConversation"],[51,35,27,37,"conversationId"],[51,49,27,51],[51,51,27,53,"onUpdate"],[51,59,27,61],[51,64,27,66],[52,6,28,8],[52,10,28,14,"room"],[52,14,28,18],[52,17,28,21],[52,41,28,45,"conversationId"],[52,55,28,59],[52,57,28,61],[53,6,29,8],[53,10,29,14,"socket"],[53,16,29,20],[53,19,29,23,"getSocket"],[53,28,29,32],[53,29,29,33],[53,30,29,34],[54,6,30,8],[54,13,30,15,"socket"],[54,19,30,21],[54,20,30,22,"subscribeToRoom"],[54,35,30,37],[54,36,30,38,"room"],[54,40,30,42],[54,42,30,44],[55,8,31,12,"connect"],[55,15,31,19],[55,17,31,21,"connect"],[55,18,31,21],[55,23,31,27],[55,24,31,29],[55,25,31,30],[56,8,32,12,"update_model"],[56,20,32,24],[56,22,32,26,"_ref3"],[56,27,32,26],[56,31,32,49],[57,10,32,49],[57,14,32,35,"jsonStr"],[57,21,32,42],[57,24,32,42,"_ref3"],[57,29,32,42],[57,30,32,29,"data"],[57,34,32,33],[58,10,33,16],[58,14,33,22,"conv"],[58,18,33,26],[58,21,33,29,"JSON"],[58,25,33,33],[58,26,33,34,"parse"],[58,31,33,39],[58,32,33,40,"jsonStr"],[58,39,33,47],[58,40,33,48],[59,10,34,16,"onUpdate"],[59,18,34,24],[59,23,34,29],[59,27,34,33],[59,31,34,37,"onUpdate"],[59,39,34,45],[59,44,34,50],[59,49,34,55],[59,50,34,56],[59,53,34,59],[59,58,34,64],[59,59,34,65],[59,62,34,68,"onUpdate"],[59,70,34,76],[59,71,34,77,"conv"],[59,75,34,81],[59,76,34,82],[60,8,35,12],[61,6,36,8],[61,7,36,9],[61,8,36,10],[62,4,37,4],[62,5,37,5],[63,4,38,4],[63,8,38,10,"getWhatsAppConnectURL"],[63,29,38,31],[63,32,38,35,"agentName"],[63,41,38,44],[63,45,38,49],[64,6,39,8],[64,10,39,14,"baseUrl"],[64,17,39,21],[64,20,39,24],[64,23,39,27,"serverUrl"],[64,32,39,36],[64,45,39,49,"appId"],[64,50,39,54],[64,61,39,65,"encodeURIComponent"],[64,79,39,83],[64,80,39,84,"agentName"],[64,89,39,93],[64,90,39,94],[64,101,39,105],[65,6,40,8],[65,10,40,14,"accessToken"],[65,21,40,25],[65,24,40,28,"token"],[65,29,40,33],[65,34,40,38],[65,38,40,42],[65,42,40,46,"token"],[65,47,40,51],[65,52,40,56],[65,57,40,61],[65,58,40,62],[65,61,40,65,"token"],[65,66,40,70],[65,69,40,73],[65,73,40,73,"getAccessToken"],[65,90,40,87],[65,91,40,87,"getAccessToken"],[65,105,40,87],[65,107,40,88],[65,108,40,89],[66,6,41,8],[66,10,41,12,"accessToken"],[66,21,41,23],[66,23,41,25],[67,8,42,12],[67,15,42,19],[67,18,42,22,"baseUrl"],[67,25,42,29],[67,35,42,39,"accessToken"],[67,46,42,50],[67,48,42,52],[68,6,43,8],[68,7,43,9],[68,13,44,13],[69,8,45,12],[70,8,46,12],[70,15,46,19,"baseUrl"],[70,22,46,26],[71,6,47,8],[72,4,48,4],[72,5,48,5],[73,4,49,4],[73,11,49,11],[74,6,50,8,"getConversations"],[74,22,50,24],[75,6,51,8,"getConversation"],[75,21,51,23],[76,6,52,8,"listConversations"],[76,23,52,25],[77,6,53,8,"createConversation"],[77,24,53,26],[78,6,54,8,"addMessage"],[78,16,54,18],[79,6,55,8,"subscribeToConversation"],[79,29,55,31],[80,6,56,8,"getWhatsAppConnectURL"],[81,4,57,4],[81,5,57,5],[82,2,58,0],[83,0,58,1],[83,3]],"functionMap":{"names":["<global>","createAgentsModule","getConversations","getConversation","listConversations","createConversation","addMessage","subscribeToConversation","socket.subscribeToRoom$argument_1.connect","socket.subscribeToRoom$argument_1.update_model","getWhatsAppConnectURL"],"mappings":"AAA;OCC;6BCE;KDE;4BEC;KFE;8BGC;KHI;+BIC;KJE;uBKC;KLQ;oCMC;qBCI,SD;0BEC;aFG;KNE;kCSC;KTU;CDU"},"hasCjsExports":false},"type":"js/module"}]}